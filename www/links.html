<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="./javascript/jquery-3.2.1.min.js"></script>
		<script src="./javascript/js.cookie.js"></script>
		<script src="./javascript/query.js"></script>
		<script src="cordova.js"></script>
		<link href="./css/styles.css" rel="stylesheet" type="text/css">
		<script>
			function loadPage() {
				var content = retrieveContent("sixth-links");

				if(content == false || content == null) {
					query("/fetch/links/list/", {"validOnly": true}, function(data) {
						loadLinks(data);
					}, function(data) {
  					sendAlert("An unexpected error occurred.", "Error");
					});

					return;
				}

				loadLinks(JSON.parse(content));
			}

			function loadLinks(data) {
				cacheContent("sixth-links", JSON.stringify(data));
				$("#ltl").empty();
				$("#perm").empty();
				$.each(data["content"]["records"], function(index, item){
					var storedDate = item["ExpiryDate"];
					var link = "javascript:openInBrowser('" + item["Link"] + "')";

					if(storedDate == 2147483647) {
						$("#perm").append('<p><a href="' + link + '">' + item["Name"] + '</a></p>');
					} else {
						var date = new Date(storedDate * 1000);
				    var displayDate = date.getDate() + "/" + (date.getMonth() + 1) + "/" + (date.getYear() + 1900);
						$("#ltl").append('<p><a href="' + link + '">' + item["Name"] + '</a> (expires on ' + displayDate + ')</p>');
					}
				});
			}
		</script>
	</head>
	<body>
		<div class="menu">
			<nav>
				<ul>
					<a href="home.html"><li>Home</li></a>
					<a href="documents.html"><li>Documents</li></a>
					<li class="current">Links</li>
					<a href="settings.html"><li>Settings</li></a>
				</ul>
			</nav>
		</div>
		<div class="content">
			<h1 class="header">Important Links</h1>
			<br>
			<h2>Limited Time Links</h2>
			<div id="ltl">
			</div>
			<br>
			<h2>Permanent Links</h2>
			<div id="perm">
			</div>
		</div>
	</body>
</html>
