<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Security-Policy" content="img-src 'self' data:; default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="./javascript/jquery-3.2.1.min.js"></script>
		<script src="./javascript/js.cookie.js"></script>
		<script src="./javascript/query.js"></script>
		<script src="cordova.js"></script>
		<link href="./css/styles.css" rel="stylesheet" type="text/css">
		<script>
			function loadPage() {
				initialLoad();

				$("#search").click(function (e) {
					e.preventDefault();
					var value = $("#contains").val();
					search(value);
				});

				$("#reset").click(function (e) {
					e.preventDefault();
					$("#contains").val("");
					search(null);
				})
			}

			function initialLoad() {
				var content = retrieveContent("sixth-announce");

				if(content == false || content == null) {
					search(null);
					return;
				}

				loadAnnouncements(JSON.parse(content));
			}

			function search(parameter) {
				query("/fetch/announcements/list/", {"limit": 10, "contains": parameter}, function(data) {
					loadAnnouncements(data);
				}, function(data) {
					sendAlert("An unexpected error occurred.", "Error");
				});
			}

			function loadAnnouncements(data) {
				cacheContent("sixth-announce", JSON.stringify(data));
				$("#announcements").empty();
				$.each(data["content"]["records"], function(index, item){
					var date = new Date(item["DateAdded"] * 1000);
			    var displayDate = date.getDate() + "/" + (date.getMonth() + 1) + "/" + (date.getYear() + 1900) + " " + date.getHours() + ":" + date.getMinutes();

					$("#announcements").append('<div class="announcement"><h2 class="title">' + item["Title"] + '</h2><p class="added">Added ' + displayDate + '. Sent to ' + item["GroupName"] + '.</p><p>' + item["Content"] + '</p></div><br>');
				});
			}
		</script>
	</head>
	<body>
		<div class="menu">
			<nav>
				<ul>
					<li class="current">Home</li>
					<a href="documents.html"><li>Documents</li></a>
					<a href="links.html"><li>Links</li></a>
					<a href="settings.html"><li>Settings</li></a>
				</ul>
			</nav>
		</div>
		<div class="content">
			<h2 id="top">Jump to Content</h2>
			<ul>
				<a href="#head_announcements"><li>Announcements</li></a>
				<a href="#head_calendar"><li>Calendar</li></a>
			</ul>
			<h1 class="header" id="head_announcements">Announcements</h1>
			<h2>Search</h2>
			<p>Contains: <input type="text" id="contains"></p>
			<button id="search">Search</button> <button id="reset">Refresh</button>
			<br>
			<br>
			<div id="announcements">
			</div>
			<br>
			<h1 class="header" id="head_calendar">Calendar</h1>
			<br>
			<iframe src="https://calendar.google.com/calendar/embed?showTitle=0&amp;showPrint=0&amp;height=600&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=milcollegeoftech%40gmail.com&amp;color=%23691426&amp;ctz=Europe%2FLondon" style="border-width:0; width:100%; height: 600px;"></iframe>
		</div>
	</body>
</html>
